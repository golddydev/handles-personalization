// REDEEMERS
const update_nft_redeemer_good = Redeemer::UPDATE_NFT_HANDLE { "xar12345" }

// DATUMS
const good_datum = Datum { 
    nft_attributes: NftAttributes {
        name: "xar12345",
        image: "ipfs://image_cid",
        mediaType: "image/png",
        og: false,
        rarity: "basic",
        length: 8,
        character_type: "characters,numbers",
        numeric_modifier: "",
        og_number: 0,
        version: 1
    }, 
    version: 1, 
    pz_data: PzData {
        custom_image: "ipfs://cid",
        bg_image: "ipfs://cid",
        pfp_image: "ipfs://cid",
        settings: "ipfs://cid",
        socials: "ipfs://cid",
        vendor: "ipfs://cid",
        default: true,
        holder: "stake1..."
    }
}

// VALIDATOR HASHES
const treasury_bytes = #01234567890123456789012345678901234567890123456789000004
const ada_handles_bytes = #01234567890123456789012345678901234567890123456789000003
const pz_provider_bytes = #01234567890123456789012345678901234567890123456789000005
const script_hash: ValidatorHash = ValidatorHash::new(#01234567890123456789012345678901234567890123456789000001)
const owner_hash: ValidatorHash = ValidatorHash::new(#01234567890123456789012345678901234567890123456789000002)
const handles_hash: ValidatorHash = ValidatorHash::new(ada_handles_bytes)
const provider_hash: ValidatorHash = ValidatorHash::new(pz_provider_bytes)

// TRANSACTION HASHES
const script_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891234)
const owner_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891235)
const handles_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891236)
const tx_output_id: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891234)

// SIGNATURE HASHES
const test_signature_hash: PubKeyHash = PubKeyHash::new(#9876543210012345678901234567890123456789012345678901234567891234)

// SETTINGS
const pz_settings = PzSettings {
    treasury_fee: 1000000,
    treasury_cred: treasury_bytes,
    pz_min_fee: 4000000,
    pz_providers: []ByteArray{ada_handles_bytes, pz_provider_bytes},
    valid_contracts: []ByteArray{#01234567890123456789012345678901234567890123456789000001},
    admin_creds: []ByteArray{},
    fee_cred: #01234567890123456789012345678901234567890123456789000004,
    inputs_cred: ada_handles_bytes
}
const pz_settings_new_contract = PzSettings {
    treasury_fee: 1000000,
    treasury_cred: treasury_bytes,
    pz_min_fee: 4000000,
    pz_providers: []ByteArray{ada_handles_bytes, pz_provider_bytes},
    valid_contracts: []ByteArray{#01234567890123456789012345678901234567890123456789000007},
    admin_creds: []ByteArray{},
    fee_cred: #01234567890123456789012345678901234567890123456789000004,
    inputs_cred: ada_handles_bytes
}


func buildOutput(credential_hash: ValidatorHash, lovelace_amt: Int, policy: MintingPolicyHash, label: ByteArray, handle: String, datum: OutputDatum) -> TxOutput {
    TxOutput::new(
        Address::new(Credential::new_validator(credential_hash), Option[StakingCredential]::None)
        , Value::lovelace(lovelace_amt) + Value::new(AssetClass::new(policy, label + (handle.encode_utf8())), 1)
        , datum
    )
}

// INPUTS
const good_owner_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0), buildOutput(owner_hash, 10000000, HANDLE_POLICY, LBL_222, "xar12345", OutputDatum::new_none()))
const good_ref_token_input: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(script_hash, 10000000, HANDLE_POLICY, LBL_100, "xar12345", OutputDatum::new_none()))
const bad_ref_token_input_name: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(script_hash, 10000000, HANDLE_POLICY, LBL_100, "xar12346", OutputDatum::new_none()))
const bad_ref_token_input_label: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(script_hash, 10000000, HANDLE_POLICY, #000653b0, "xar12345", OutputDatum::new_none()))
const bad_ref_token_input_creds: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(owner_hash, 10000000, HANDLE_POLICY, LBL_100, "xar12345", OutputDatum::new_none()))
const bad_ref_token_input_policy: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(script_hash, 10000000, MintingPolicyHash::new(#f0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9b), LBL_100, "xar12345", OutputDatum::new_none()))
const not_real_handle_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0), buildOutput(owner_hash, 10000000, MintingPolicyHash::new(#f0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9b), LBL_222, "xar12345", OutputDatum::new_none()))
const wrong_handle_name_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0), buildOutput(owner_hash, 10000000, HANDLE_POLICY, LBL_222, "xar12346", OutputDatum::new_none()))
const wrong_handle_label_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0), buildOutput(owner_hash, 10000000, HANDLE_POLICY, #000653b0, "xar12346", OutputDatum::new_none()))

// REFERENCE INPUTS
const good_ref_input_bg: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0), buildOutput(handles_hash, 10000000, HANDLE_POLICY, LBL_222, "bg_policy_ids", OutputDatum::new_none()))
const good_ref_input_bg_sub: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0), buildOutput(provider_hash, 10000000, HANDLE_POLICY, LBL_222, "partner@bg_policy_ids", OutputDatum::new_none()))
const good_ref_input_pfp: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0), buildOutput(handles_hash, 10000000, HANDLE_POLICY, LBL_222, "pfp_policy_ids", OutputDatum::new_none()))
const good_ref_input_pfp_sub: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0), buildOutput(provider_hash, 10000000, HANDLE_POLICY, LBL_222, "partner@pfp_policy_ids", OutputDatum::new_none()))
const good_ref_input_pz: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(handles_hash, 10000000, HANDLE_POLICY, LBL_222, "pz_settings", OutputDatum::new_inline(pz_settings)))
const bad_ref_input_pz: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(provider_hash, 10000000, HANDLE_POLICY, LBL_222, "pz_settings", OutputDatum::new_inline(pz_settings)))
const good_ref_input_pz_new_contract: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), buildOutput(handles_hash, 10000000, HANDLE_POLICY, LBL_222, "pz_settings", OutputDatum::new_inline(pz_settings_new_contract)))

// OUTPUTS
const good_owner_output: TxOutput = buildOutput(owner_hash, 10000000, HANDLE_POLICY, LBL_222, "xar12345", OutputDatum::new_none())
const good_ref_token_output: TxOutput = buildOutput(script_hash, 10000000, HANDLE_POLICY, LBL_100, "xar12345", OutputDatum::new_none())
const good_treasury_output: TxOutput = buildOutput(ValidatorHash::new(treasury_bytes), 10000000, MintingPolicyHash::new(#), #, "", OutputDatum::new_none())
const good_provider_output: TxOutput = buildOutput(ValidatorHash::new(pz_provider_bytes), 10000000, MintingPolicyHash::new(#), #, "", OutputDatum::new_none())
const bad_output_fee: TxOutput = buildOutput(ValidatorHash::new(ada_handles_bytes), 100000, MintingPolicyHash::new(#), #, "", OutputDatum::new_none())
const bad_output_address: TxOutput = buildOutput(ValidatorHash::new(#01234567890123456789012345678901234567890123456789000006), 10000000, MintingPolicyHash::new(#), #, "", OutputDatum::new_none())
const bad_ref_token_output: TxOutput = buildOutput(owner_hash, 10000000, HANDLE_POLICY, LBL_100, "xar12345", OutputDatum::new_none())

// CONTEXTS

// ScriptContext wraps a Tx object:
// Tx::new(
//     inputs:      []TxInput,
//     ref_inputs:  []TxInput,
//     outputs:     []TxOutput,
//     fee:         Value,
//     minted:      Value,
//     dcerts:      []DCert,
//     withdrawals: Map[StakingCredential]Int,
//     time_range:  TimeRange,
//     signatories: []PubKeyHash,
//     redeemers:   Map[ScriptPurpose]AnyType,
//     datums:      Map[DatumHash]AnyType
// ) -> Tx

func buildScriptContext(inputs: []TxInput, ref_inputs: []TxInput, outputs: []TxOutput) -> ScriptContext {
    ScriptContext::new_spending(
        Tx::new(
            inputs,
            ref_inputs,
            outputs,
            Value::lovelace(160000),
            Value::ZERO,
            []DCert{},
            Map[StakingCredential]Int{},
            TimeRange::from(Time::new(1001)),
            []PubKeyHash{test_signature_hash},
            Map[ScriptPurpose]Data{},
            Map[DatumHash]Data{}
        ),
        TxOutputId::new(tx_output_id, 0)
    )
}
const good_default: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const good_ref_sub: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg_sub, good_ref_input_pfp_sub, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_wrong_output: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, bad_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_name: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_name},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_label: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_label},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_creds: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_creds},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_policy: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_bg_ref_input: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_policy},
    []TxInput{good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_pfp_ref_input: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_pz_ref_input: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pfp},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const handle_missing_from_inputs: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const not_a_real_handle: ScriptContext = buildScriptContext(
    []TxInput{not_real_handle_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_handle_name: ScriptContext = buildScriptContext(
    []TxInput{wrong_handle_name_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_handle_label: ScriptContext = buildScriptContext(
    []TxInput{wrong_handle_label_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const provider_fee_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, bad_output_fee}
)
const provider_address_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, bad_output_address}
)
const treasury_fee_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, bad_output_fee, good_provider_output}
)
const treasury_address_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, bad_output_address, good_provider_output}
)
const pz_settings_wrong_address: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, bad_ref_input_pz},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_contract_address: ScriptContext = buildScriptContext(
    []TxInput{good_owner_input, good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz_new_contract},
    []TxOutput{good_owner_output, good_ref_token_output, good_treasury_output, good_provider_output}
)