// STRINGS
const handle = "xar12345"
// REDEEMERS
const update_nft_redeemer_good = Redeemer::UPDATE_NFT_HANDLE { handle }
const good_admin_redeemer = Redeemer::ADMIN_UPDATE

// DATUMS
const good_datum = Datum { 
    nft_attributes: NftAttributes {
        name: handle,
        image: "ipfs://image_cid",
        mediaType: "image/png",
        og: false,
        rarity: "basic",
        length: 8,
        character_type: "characters,numbers",
        numeric_modifier: "",
        og_number: 0,
        version: 1
    }, 
    version: 1, 
    pz_data: PzData {
        custom_image: "ipfs://cid",
        bg_image: "ipfs://cid",
        pfp_image: "ipfs://cid",
        settings: "ipfs://cid",
        socials: "ipfs://cid",
        vendor: "ipfs://cid",
        default: true,
        holder: "stake1..."
    }
}

func bytes_to_addr(addr: ByteArray) -> Address {
    Address::from_data(OutputDatum::new_inline(addr).data)
}

// HASHES
const admin_bytes = #01234567890123456789012345678901234567890123456789000007
const script_creds_bytes = #01234567890123456789012345678901234567890123456789000001
const owner_bytes = #9876543210012345678901234567890123456789012345678901234567891235
const script_hash: ValidatorHash = ValidatorHash::new(script_creds_bytes)
const owner_hash: PubKeyHash = PubKeyHash::new(owner_bytes)
const treasury_address = #01f3ee7285f975e001222c8fa065b19a328938fdb8309cb9a35f2bfc7bc251da0507cacfe8146dcb7e528c695a35824bc1d005880b234a507d
const ada_handles_address = #01f3ee7285f975e001222c8fa065b19a328938fdb8309cb9a35f2bfc7bc251da0507cacfe8146dcb7e528c695a35824bc1d005880b234a507f
const pz_provider_address = #01f3ee7285f975e001222c8fa065b19a328938fdb8309cb9a35f2bfc7bc251da0507cacfe8146dcb7e528c695a35824bc1d005880b234a507e

// TRANSACTION HASHES
const script_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891234)
const owner_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891235)
const handles_tx_hash: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891236)
const tx_output_id: TxId = TxId::new(#0123456789012345678901234567890123456789012345678901234567891234)

// SIGNATURE HASHES
const owner_pubkey_hash: PubKeyHash = PubKeyHash::new(#9876543210012345678901234567890123456789012345678901234567891235)

// SETTINGS
const pz_settings = PzSettings {
    treasury_fee: 1000000,
    treasury_address: #5839 + treasury_address,
    pz_min_fee: 4000000,
    pz_providers: []ByteArray{#5839 + ada_handles_address, #5839 + pz_provider_address},
    valid_contracts: []ByteArray{#01234567890123456789012345678901234567890123456789000001},
    admin_creds: []ByteArray{admin_bytes},
    inputs_address: #5839 + ada_handles_address
}
const pz_settings_new_contract = PzSettings {
    treasury_fee: 1000000,
    treasury_address: #5839 + treasury_address,
    pz_min_fee: 4000000,
    pz_providers: []ByteArray{#5839 + ada_handles_address, #5839 + pz_provider_address},
    valid_contracts: []ByteArray{#01234567890123456789012345678901234567890123456789000007},
    admin_creds: []ByteArray{},
    inputs_address: #5839 + ada_handles_address
}

// INPUTS
const good_ref_token_input: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), 
    TxOutput::new(
        Address::new(Credential::new_validator(script_hash), Option[StakingCredential]::None)
        , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_100 + (handle.encode_utf8())), 1)
        , OutputDatum::new_none()
    )
)
const bad_ref_token_input_name: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0), 
    TxOutput::new(
        Address::new(Credential::new_validator(script_hash), Option[StakingCredential]::None)
        , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_100 + ("xar12346".encode_utf8())), 1)
        , OutputDatum::new_none()
    )
)
const bad_ref_token_input_label: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_validator(script_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, #000653b0 + ("xar12346".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const bad_ref_token_input_creds: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_100 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const bad_ref_token_input_policy: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_validator(script_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(MintingPolicyHash::new(#f0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9b), LBL_100 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const not_real_handle_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(MintingPolicyHash::new(#f0ff48bbb7bbe9d59a40f1ce90e9e9d0ff5002ec48f232b49ca0fb9b), LBL_222 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )

// REFERENCE INPUTS
const good_owner_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const wrong_handle_name_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("xar12346".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const wrong_handle_label_input: TxInput = TxInput::new(TxOutputId::new(owner_tx_hash, 0),
        TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, #000653b0 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const good_ref_input_bg: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(ada_handles_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("bg_policy_ids".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const good_ref_input_bg_sub: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("partner@bg_policy_ids".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const good_ref_input_pfp: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(ada_handles_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("pfp_policy_ids".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const good_ref_input_pfp_sub: TxInput = TxInput::new(TxOutputId::new(handles_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("partner@pfp_policy_ids".encode_utf8())), 1)
            , OutputDatum::new_none()
        )
    )
const good_ref_input_pz: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(ada_handles_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("pz_settings".encode_utf8())), 1)
            , OutputDatum::new_inline(pz_settings)
        )
    )
const bad_ref_input_pz: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("pz_settings".encode_utf8())), 1)
            , OutputDatum::new_inline(pz_settings)
        )
    )
const good_ref_input_pz_new_contract: TxInput = TxInput::new(TxOutputId::new(script_tx_hash, 0),
        TxOutput::new(
            bytes_to_addr(ada_handles_address)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + ("pz_settings".encode_utf8())), 1)
            , OutputDatum::new_inline(pz_settings_new_contract)
        )
    )

// OUTPUTS
const good_owner_output: TxOutput = TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_222 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none())
const good_ref_token_output: TxOutput = TxOutput::new(
            Address::new(Credential::new_validator(script_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_100 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none())
const good_treasury_output: TxOutput = TxOutput::new(
            bytes_to_addr(treasury_address)
            , Value::lovelace(10000000)
            , OutputDatum::new_inline(handle.encode_utf8()))
const bad_treasury_output_datum: TxOutput = TxOutput::new(
            bytes_to_addr(treasury_address)
            , Value::lovelace(10000000)
            , OutputDatum::new_inline("xar12346".encode_utf8()))
const good_provider_output: TxOutput = TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(10000000)
            , OutputDatum::new_inline(handle.encode_utf8()))
const bad_provider_output_datum: TxOutput = TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(10000000)
            , OutputDatum::new_inline("xar12346".encode_utf8()))
const bad_output_fee: TxOutput = TxOutput::new(
            bytes_to_addr(treasury_address)
            , Value::lovelace(100000)
            , OutputDatum::new_inline(handle.encode_utf8()))
const bad_provider_output_fee: TxOutput = TxOutput::new(
            bytes_to_addr(pz_provider_address)
            , Value::lovelace(100000)
            , OutputDatum::new_inline(handle.encode_utf8()))
const bad_output_address: TxOutput = TxOutput::new(
            bytes_to_addr(#01f3ee7285f975e001222c8fa065b19a328938fdb8309cb9a35f2bfc7bc251da0507cacfe8146dcb7e528c695a35824bc1d005880b234a507a)
            , Value::lovelace(10000000)
            , OutputDatum::new_inline(handle.encode_utf8()))
const bad_ref_token_output: TxOutput = TxOutput::new(
            Address::new(Credential::new_pubkey(owner_hash), Option[StakingCredential]::None)
            , Value::lovelace(10000000) + Value::new(AssetClass::new(HANDLE_POLICY, LBL_100 + (handle.encode_utf8())), 1)
            , OutputDatum::new_none())

// CONTEXTS

// ScriptContext wraps a Tx object:
// Tx::new(
//     inputs:      []TxInput,
//     ref_inputs:  []TxInput,
//     outputs:     []TxOutput,
//     fee:         Value,
//     minted:      Value,
//     dcerts:      []DCert,
//     withdrawals: Map[StakingCredential]Int,
//     time_range:  TimeRange,
//     signatories: []PubKeyHash,
//     redeemers:   Map[ScriptPurpose]AnyType,
//     datums:      Map[DatumHash]AnyType
// ) -> Tx

func buildScriptContext(inputs: []TxInput, ref_inputs: []TxInput, outputs: []TxOutput, signers: []PubKeyHash = []PubKeyHash{owner_pubkey_hash}) -> ScriptContext {
    ScriptContext::new_spending(
        Tx::new(
            inputs,
            ref_inputs,
            outputs,
            Value::lovelace(160000),
            Value::ZERO,
            []DCert{},
            Map[StakingCredential]Int{},
            TimeRange::from(Time::new(1001)),
            signers,
            Map[ScriptPurpose]Data{},
            Map[DatumHash]Data{}
        ),
        TxOutputId::new(tx_output_id, 0)
    )
}
const good_default: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const good_ref_sub: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg_sub, good_ref_input_pfp_sub, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_wrong_output: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{bad_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_name: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_name},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_label: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_label},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_creds: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_creds},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const bad_ref_token_policy: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_bg_ref_input: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_policy},
    []TxInput{good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_pfp_ref_input: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const missing_pz_ref_input: ScriptContext = buildScriptContext(
    []TxInput{bad_ref_token_input_policy},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const handle_missing_from_inputs: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const not_a_real_handle: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, not_real_handle_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_handle_name: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, wrong_handle_name_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_handle_label: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, wrong_handle_label_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const provider_fee_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, bad_provider_output_fee}
)
const provider_address_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, bad_output_address}
)
const provider_datum_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, bad_provider_output_datum}
)
const treasury_fee_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, bad_output_fee, good_provider_output}
)
const treasury_address_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, bad_output_address, good_provider_output}
)
const treasury_datum_wrong: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, bad_treasury_output_datum, good_provider_output}
)
const pz_settings_wrong_address: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, bad_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const wrong_contract_address: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz_new_contract, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output}
)
const good_admin_ctx: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output},
    []PubKeyHash{PubKeyHash::new(admin_bytes)}
)
const wrong_admin_ctx: ScriptContext = buildScriptContext(
    []TxInput{good_ref_token_input},
    []TxInput{good_ref_input_bg, good_ref_input_pfp, good_ref_input_pz, good_owner_input},
    []TxOutput{good_ref_token_output, good_treasury_output, good_provider_output},
    []PubKeyHash{PubKeyHash::new(#01234567890123456789012345678901234567890123456789000008)}
)